import hashlib
import os
from random import randint

from faker import Faker
from werkzeug.security import generate_password_hash

from app import app, db
from config import PROCESSING_STATUS_ID
from models import Role, User, Cover, Book, Genre, BookGenre, Review, ModerationStatus

roles = [
    {
        'name': 'administrator',
        'description': 'суперпользователь, имеет полный доступ к системе, в том числе к созданию и удалению книг',
    },
    {
        'name': 'moderator',
        'description': 'может редактировать данные книг и производить модерацию рецензий',
    },
    {
        'name': 'user',
        'description': 'может оставлять рецензии',
    },
]

users = [
    {'id': 1, 'username': 'Apkawa', 'password_hash': generate_password_hash('qwerty1'), 'last_name': 'Минчаков', 'first_name': 'Аркадий', 'role_id': 1},
    {'id': 2, 'username': 'MegaVanya228', 'password_hash': generate_password_hash('qwerty2'), 'last_name': 'Иванов', 'first_name': 'Иван', 'patronymic': 'Иванович', 'role_id': 2},
    {'id': 3, 'username': 'Person',  'password_hash': generate_password_hash('qwerty3'), 'last_name': 'Неизвестный', 'first_name': 'Андрей', 'role_id': 3},
]

moderation_statuses = [
    {'id': PROCESSING_STATUS_ID, 'name': 'На рассмотрении'},
    {'name': 'Одобрено'},
    {'name': 'Отклонено'},
]

books = [
    {
        'id': 1,
        'name': 'Первому игроку приготовиться',
        'description': 'В 2045 году реальный мир – не самое приятное место. По-настоящему живым Уэйд Уоттс чувствует себя лишь в OASISе – огромном виртуальном пространстве, где проводит свои дни большая часть человечества. Перед смертью эксцентричный создатель OASISа, одержимый по-культурой прошлих лет, составляет на ее основе ряд сложнейших головоломок. Тот, кто разгадает их первым, унаследует его огромное состояние – и контроль над самим OASISом.',
        'year': 2011,
        'publisher': 'Литературный ветер',
        'author': 'Эрнест Клайн',
        'page_count': 443,
    },
    {
        'id': 2,
        'name': 'Автостопом по галактике',
        'description': 'Дом главного героя Артура Дента пытаются снести для постройки новой автодороги. Чтобы остановить снос, Артур ложится перед бульдозером, после чего прибывает его друг Форд Префект. Форд рассказывает Артуру, что является пришельцем из окрестностей Бетельгейзе и что планету Земля планируют уничтожить для постройки гиперпространственной магистрали.',
        'year': 1985,
        'publisher': 'Золотое перо',
        'author': 'Дуглас Адамс',
        'page_count': 240,
    },
    {
        'id': 3,
        'name': 'Пламя и кровь',
        'description': 'Тирион Ланнистер еще не стал заложником жестокого рока, Бран Старк еще не сделался калекой, а голова его отца Неда Старка еще не скатилась с эшафота. Ни один человек в Королевствах не смеет даже предположить, что Дейенерис Таргариен когда-нибудь назовут Матерью Драконов. Вестерос не привел к покорности соседние государства, и Железный Трон, который, согласно поговорке, ковался в крови и пламени, далеко еще не насытился.',
        'year': 2018,
        'publisher': 'Тихий шелест',
        'author': 'Джордж Мартин',
        'page_count': 380,
    },
    {
        'id': 4,
        'name': 'Танец с драконами',
        'description': '«Танцем драконов» издавна звали в Семи Королевствах войну. Но теперь война охватывает все новые и новые земли. Война катится с Севера – из-за Стены. Война идет с Запада – с Островов.Войну замышляет Юг, мечтающий посадить на Железный Трон свою ставленницу. И совсем уже неожиданную угрозу несет с Востока вошедшая в силу «мать драконов» Дейенерис…',
        'year': 2011,
        'publisher': 'Звездная поляна',
        'author': 'Джордж Мартин',
        'page_count': 598,
    },
    {
        'id': 5,
        'name': 'Этюд в багровых тонах',
        'description': 'Врач снимает квартиру вместе с частным сыщиком. Расследуя вместе с ним преступление, доктор ведёт дневник, из которого публика узнаёт о сыщике Шерлоке Холмсе.',
        'year': 1887,
        'publisher': 'Лесные сказки',
        'author': 'Артур Конан Дойл',
        'page_count': 151,
    },
    {
        'id': 6,
        'name': 'Собака Баскервилей',
        'description': 'По преданию, род Баскервилей с XVII века преследует чудовищная собака. Когда сэр Чарльз Баскервиль умирает при загадочных обстоятельствах, а рядом с телом находят собачьи следы, расследовать это дело берутся знаменитый сыщик Шерлок Холмс и его друг доктор Уотсон. Им предстоит схватка с дерзким и опасным противником, не уступающим Холмсу в изобретательности.',
        'year': 1902,
        'publisher': 'Морские глубины',
        'author': 'Артур Конан Дойл',
        'page_count': 190,
    },
    {
        'id': 7,
        'name': 'Мы',
        'description': '. Роман об «обществе равных», в котором человеческая личность сведена к «нумеру». В нем унифицировано все – одежда и квартиры, мысли и чувства. Нет ни семьи, ни прочных привязанностей…',
        'year': 1920,
        'publisher': 'Солнечная стрела',
        'author': 'Е. И. Замятин',
        'page_count': 181,
    },
    {
        'id': 8,
        'name': 'Мастер и Маргарита',
        'description': 'Жарким майским вечером председатель правления МАССОЛИТ Михаил Берлиоз и молодой поэт Иван Бездомный отправились на Патриаршие пруды, чтобы обсудить: существовал ли Иисус Христос. Беседой литераторов заинтересовался некий импозантный гражданин-иностранец. Профессор Воланд стал уверять новых знакомых, что лично присутствовал на допросе бродяги Иешуа Га-Ноцри, который проводил Понтий Пилат.',
        'year': 1967,
        'publisher': 'Вечерние огни',
        'author': 'М. А. Булгаков',
        'page_count': 470,
    },
    {
        'id': 9,
        'name': 'Железный король',
        'description': ' Великий магистр ордена тамплиеров Жак де Моле, взойдя на костер 18 марта 1314 года, проклял своих палачей – папу Климента V, короля Филиппа Красивого, его советника Гийома де Ногаре и все их помство до тринадцатого колена. Первый удар судьбы – обвинение невесток короля в неверности – не замедлил последовать. Но еще никто не знает, какие беды сулит будущее Железному королю…',
        'year': 1955,
        'publisher': 'Небесная книга',
        'author': 'Морис Дрюон',
        'page_count': 350,
    },
    {
        'id': 10,
        'name': 'Чингисхан',
        'description': 'Это яркое историческое произведение, раскрывающее перед читателем само становление экспансионистской программы ордынского правителя, показывающее сложную подготовку хана-завоевателя к решающим схваткам с одним из зрелых феодальных организмов Средней Азии – Хорезмом, создающее широкую картину захвата и разорения Хорезмийского государства полчищами Чингиз-хана. ',
        'year': 1939,
        'publisher': 'Серебрянный Лист',
        'author': 'В. Г. Ян',
        'page_count': 400,
    },
    {
        'id': 11,
        'name': 'Жажда жизни',
        'description': 'Биографический роман Ирвинга Стоуна 1934 года о жизни голландского художника Винсента ван Гога и его невзгодах.',
        'year': 1934,
        'publisher': 'Морские глубины',
        'author': 'Ирвинг Стоун',
        'page_count': 640,
    },
    {
        'id': 12,
        'name': 'Почти серьезно',
        'description': 'Правдивая и тонкая биография заслуженного артиста СССР Юрия Никулина!',
        'year': 1976,
        'publisher': 'Солнечная стрела',
        'author': 'Юрий Никулин',
        'page_count': 784,
    },
    {
        'id': 13,
        'name': 'Краткая история времени',
        'description': ' В этой книге автор пытается ответить на самые сложные и интригующие вопросы о мироздании: когда и почему началась Вселенная? безгранична ли Вселенная или у нее есть предел? всегда ли время текло вдоль привычного для нас вектора? возможны ли путешествия во времени? что ожидает космос в далеком будущем?',
        'year': 1988,
        'publisher': 'Золотое перо',
        'author': 'Стивен Хокинг',
        'page_count': 320,
    },
    {
        'id': 14,
        'name': 'Теория всего',
        'description': 'Книга объединяет семь лекций, охватывающих широкий диапазон тем: от Большого взрыва и черных дыр до теории струн. Автор описывает представления о Вселенной – от постулата о том, что Земля имеет форму шара, до теории о расширении Вселенной, основанной на недавних наблюдениях.',
        'year': 2006,
        'publisher': 'Литературный ветер',
        'author': 'Стивен Хокинг',
        'page_count': 149,
    },
    {
        'id': 15,
        'name': 'Важные годы. Почему не стоит откладывать жизнь на потом',
        'description': 'Эта книга о десятилетии, определяющем судьбу человека. Инвестиции, сделанные в этот период в собственное развитие во всех сферах жизни, принесут максимальную отдачу. Автор объясняет, почему не стоит откладывать начало взрослой жизни на потом, и рассказывает, что нужно делать в это время жизни человека.',
        'year': 2012,
        'publisher': 'Вечерние огни',
        'author': 'Мэг Джей',
        'page_count': 271,
    },
    {
        'id': 16,
        'name': 'НИ СЫ. Иди вперед и ничего не бойся',
        'description': 'Хочешь жить так, как никогда не жил - начни делать то, что никогда не делал. Главная формула саморазвития, которую можно свести к "восточной мудрости" - НИ СЫ.',
        'year': 2020,
        'publisher': 'Серебрянный Лист',
        'author': 'Джен Синсеро',
        'page_count': 304,
    },
    {
        'id': 17,
        'name': 'Чертоги разума',
        'description': '«Чертоги разума» – научно-популярная книга Андрея Курпатова, полностью посвященная работе мозга и эффективным практикам улучшения качества жизни.',
        'year': 2018,
        'publisher': 'Звездная поляна',
        'author': 'Андрей Курпатов',
        'page_count': 330,
    },
    {
        'id': 18,
        'name': 'Свобода от тревоги. Справиться с тревогой, пока она не расправилась с тобой',
        'description': 'Из этой книги вы узнаете, как обмануть свой страх и научиться справляться со стрессом. Здесь вы найдете простое пошаговое руководство, чтобы преодолеть любые виды беспокойства. Теперь вы навсегда избавитесь от тревоги и начнете жить полной жизнью.',
        'year': 2009,
        'publisher': 'Лесные сказки',
        'author': 'Роберт Лихи',
        'page_count': 447,
    },
    {
        'id': 19,
        'name': 'Таинственный остров',
        'description': 'Во времена гражданской войны в США пятеро смельчаков-северян спасаются от плена на воздушном шаре. Страшная буря выбрасывает их на берег необитаемого острова. Отвага и таланты новых поселенцевострова помогают им обустроить свою жизнь, не испытывая нужды ни в еде, ни в одежде, ни в тепле и уюте. Мирное пребывание «робинзонов» на острове нарушает угроза нападения пиратов, но какая-то таинственная сила помогает им в самых сложных ситуациях.',
        'year': 1875,
        'publisher': 'Тихий шелест',
        'author': 'Жюль Верн',
        'page_count': 650,
    },
    {
        'id': 20,
        'name': 'Зов предков',
        'description': 'Подчиняясь «зову предков», домашний пес Бэк одичал и ушел в волчью стаю… Тысячи людей, томимые жаждой наживы, которая пробуждает зов первобытной дикости, устремились в живописный Клондайкский край – неизвестный и загадочный мир Севера, суровых испытаний и золота!',
        'year': 1903,
        'publisher': 'Небесная Книга',
        'author': 'Джек Лондон',
        'page_count': 110,
    },
    {
        'id': 21,
        'name': 'Сияние',
        'description': 'Бывший преподаватель Джек Торранс устраивается зимним сторожем в горный отель «Оверлук» и переезжает в него со своими женой и сыном. Будучи изолированным от внешнего мира, Джек испытывает постоянное влияние тёмной сущности отеля и призраков, обитающих в его стенах.',
        'year': 1977,
        'publisher': 'Тихий шелест',
        'author': 'Стивен Кинг',
        'page_count': 620,
    },
    {
        'id': 22,
        'name': 'Кладбище домашних животных',
        'description': 'Казалось бы, семейство Крид - это настоящее воплощение "американской мечты": отец - преуспевающий врач, красавица мать, прелестные дети. Для полной идиллии им не хватает лишь большого старинного дома, куда они вскоре и переезжают. Но идиллия вдруг стала превращаться в кошмар. Потому что в окружающих их новое жилище вековых лесах скрывается НЕЧТО, более ужасное, чем сама смерть и… более могущественное.',
        'year': 1983,
        'publisher': 'Небесная книга',
        'author': 'Стивен Кинг',
        'page_count': 480,
    },
    {
        'id': 23,
        'name': 'Абсент',
        'description': 'Книга известного английского культуролога Фила Бейкера рассказывает удивительнуюисторию абсента от времен Древней Греции и Рима до наших дней.',
        'year': 2002,
        'publisher': 'Золотое перо',
        'author': 'Фил Бейкер',
        'page_count': 288,
    },
    {
        'id': 24,
        'name': 'Вино. Практический путеводитель',
        'description': 'Идеальный бумажный путеводитель по вину для эпохи цифровых технологий. Ясный, живой, без излишней заумности.',
        'year': 2015,
        'publisher': 'Солнечная стрела',
        'author': 'Джастин Хэммек',
        'page_count': 234,
    },
    {
        'id': 25,
        'name': 'Искусство видеть',
        'description': 'На примере общеизвестных произведений изобразительного искусстваи типичных рекламных изображений Бергер показывает, что наряду с непосредственным сообщением практически каждая картина, каждый визуальный объект массовой культуры несёт в себе идеологический заряд, обусловленный интересами доминирующего класса или же доминирующего пола.',
        'year': 1972,
        'publisher': 'Литературный ветер',
        'author': 'Джон Бергер',
        'page_count': 216,
    },
    {
        'id': 26,
        'name': 'Япония. Введение в искусство и кульутуру',
        'description': 'Гора Фудзи, лепестки сакуры, роботы, аниме и манга – Япония ассоциируется с целым набором образов. Но несмотря на то, что японская культура активно проникает на запад, эта страна продолжает оставаться загадочной и непознанной. Эта книга познакомит вас со Страной восходящего солнца, расскажет об истории и религии, искусстве и культурном влиянии на другие страны.',
        'year': 2019,
        'publisher': 'Звездная поляна',
        'author': 'Анна Пушакова',
        'page_count': 165,
    },
    {
        'id': 27,
        'name': 'Комедии',
        'description': 'В книге представлены четыре комедии величайшего английского писателя Уильяма Шекспира: «Сон в летнюю ночь», «Много шума из ничего», «Как вам это понравится» и «Двенадцатая ночь». Комедии Шекспира восхищают нас живостью, остроумием и искрящимся весельем, энергичностью, находчивостью и оптимизмом героев.',
        'year': 2017,
        'publisher': 'Вечерние огни',
        'author': 'Уильям Шекспир',
        'page_count': 309,
    },
    {
        'id': 28,
        'name': 'Трагедии',
        'description': 'Издание выпущено в 1954 году Государственным издательством Художественной Литературы, Москва. Издательский переплет. Сохранность хорошая. В сборник вошли трагедии: "Эдип-царь", "Эдип в Колоне", "Антигона", "Трахинянки", "Аянт", "Филоктет".',
        'year': 1988,
        'publisher': 'Морские глубины',
        'author': 'Софокл',
        'page_count': 496,
    },
    {
        'id': 29,
        'name': 'Ёжик в тумане',
        'description': 'Ёжик и Медвежонок - настоящие неразлучные друзья. Они ходят друг к другу в гости, вместе сумерничают, читают стихи великих поэтов. Ёжик любит протирать звёзды, чтобы они не потускнели, а Медвежонок водит знакомство с Солнечным зайцем и знает, как перехитрить время. ',
        'year': 1972,
        'publisher': 'Серебрянный Лист',
        'author': 'С. С. Козлов',
        'page_count': 91,
    },
    {
        'id': 30,
        'name': 'Пеппи Длинныйчулок',
        'description': 'Никого на свете нет сильнее Пеппи, она способна уложить на лопатки даже самого прославленного силача. Но не только этим знаменита Пеппи. Ещё она самая весёлая, самая непредсказуемая, самая озорная и самая добрая девочка в мире, с которой непременно хочется подружиться!',
        'year': 1945,
        'publisher': 'Лесные сказки',
        'author': 'Астрид Линдгрен',
        'page_count': 326,
    },
]

genres = [
    {'id': 1, 'name': 'Фантастика'},
    {'id': 2, 'name': 'Фэнтези'},
    {'id': 3, 'name': 'Детективы'},
    {'id': 4, 'name': 'Романы'},
    {'id': 5, 'name': 'Исторические'},
    {'id': 6, 'name': 'Биография и мемуары'},
    {'id': 7, 'name': 'Научная литература'},
    {'id': 8, 'name': 'Саморазвитие и мотивация'},
    {'id': 9, 'name': 'Психология'},
    {'id': 10, 'name': 'Приключение'},
    {'id': 11, 'name': 'Ужасы и мистика'},
    {'id': 12, 'name': 'Кулинарные книги'},
    {'id': 13, 'name': 'Искусство и культура'},
    {'id': 14, 'name': 'Поэзия и драматургия'},
    {'id': 15, 'name': 'Детская литература'},
]

book_genres = [
    {'book_id': 1, 'genre_id': 1},
    {'book_id': 1, 'genre_id': 4},
    {'book_id': 1, 'genre_id': 10},
    {'book_id': 2, 'genre_id': 1},
    {'book_id': 2, 'genre_id': 10},
    {'book_id': 3, 'genre_id': 2},
    {'book_id': 4, 'genre_id': 2},
    {'book_id': 5, 'genre_id': 3},
    {'book_id': 6, 'genre_id': 3},
    {'book_id': 7, 'genre_id': 4},
    {'book_id': 8, 'genre_id': 4},
    {'book_id': 8, 'genre_id': 2},
    {'book_id': 9, 'genre_id': 5},
    {'book_id': 9, 'genre_id': 4},
    {'book_id': 10, 'genre_id': 5},
    {'book_id': 11, 'genre_id': 6},
    {'book_id': 12, 'genre_id': 6},
    {'book_id': 13, 'genre_id': 7},
    {'book_id': 14, 'genre_id': 7},
    {'book_id': 15, 'genre_id': 8},
    {'book_id': 16, 'genre_id': 8},
    {'book_id': 17, 'genre_id': 9},
    {'book_id': 18, 'genre_id': 9},
    {'book_id': 19, 'genre_id': 10},
    {'book_id': 19, 'genre_id': 4},
    {'book_id': 20, 'genre_id': 10},
    {'book_id': 21, 'genre_id': 11},
    {'book_id': 21, 'genre_id': 2},
    {'book_id': 21, 'genre_id': 1},
    {'book_id': 22, 'genre_id': 11},
    {'book_id': 22, 'genre_id': 2},
    {'book_id': 22, 'genre_id': 1},
    {'book_id': 23, 'genre_id': 12},
    {'book_id': 24, 'genre_id': 12},
    {'book_id': 25, 'genre_id': 13},
    {'book_id': 26, 'genre_id': 13},
    {'book_id': 27, 'genre_id': 14},
    {'book_id': 28, 'genre_id': 14},
    {'book_id': 29, 'genre_id': 15},
    {'book_id': 30, 'genre_id': 15},
]

fake = Faker()


def calculate_hash(file_path):
    hash_md5 = hashlib.md5()
    with open(file_path, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()


with app.app_context():
    db.drop_all()
    db.session.commit()
    db.create_all()

    for role in roles:
        db.session.add(Role(**role))

    for user in users:
        db.session.add(User(**user))

    for moderation_status in moderation_statuses:
        db.session.add(ModerationStatus(**moderation_status))

    for cover_id in range(1, 31):
        image_path = os.path.join('static/images', f'{cover_id}.jpg')
        db.session.add(Cover(id=cover_id, filename=str(cover_id), mime_type='jpg', md5_hash=calculate_hash(image_path)))
    db.session.flush()

    for cover_id, book in enumerate(books, 1):
        db.session.add(Book(**book, cover_id=cover_id))

        for user_id in range(1, 4):
            has_reviewed = randint(0, 1)
            if has_reviewed:
                status_id = randint(1, 4)
                if status_id > 3:
                    status_id = 2
                db.session.add(Review(grade=randint(0, 5), text=fake.text(50), book_id=book['id'], user_id=user_id, status_id=status_id))

    for genre in genres:
        db.session.add(Genre(**genre))
    db.session.flush()

    for book_genre in book_genres:
        db.session.add(BookGenre(**book_genre))
    db.session.commit()
